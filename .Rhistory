dtree2.out<-confusionMatrix(data=dtree2.pred,reference=validate$diabetes,positive="Yes")
#77.68
##crossvalidation to find minimum error tree
cv.dtree2<-cv.tree(dtree2,FUN=prune.misclass)
cv.dtree2
###best tree with 3 nodes
##best model with 3 nodes
dtree2.prune<-prune.misclass(dtree2,best=3)
summary(dtree.prune)
plot(dtree.prune)
text(dtree.prune,pretty=0)
##prediction on test dataset
dtree2.prune.pred<-predict(dtree2.prune,validate,type="class")
dtree2.prune.out<-confusionMatrix(data=dtree2.prune.pred,reference=validate$diabetes,positive="Yes")
#77.68
#####KNN NORMALIZED#####
knn.pred<-list()
knn.missrate<-c()
for (i in 1:25){
a<-knn(train = normtrain[,-7],test=normvalidate[,-7],k = i,cl=normtrain$diabetes)
knn.pred[[i]]<-a
knn.missrate[i]<-mean(ifelse(knn.pred[[i]]==normvalidate$diabetes,FALSE,TRUE))
}
k<-c(1:25)
names(knn.pred)<-paste("K=",c(1:25),sep="")
knn.plot<-ggplot()+geom_line(aes(x=k,y=knn.missrate))
ggsave("plots/knnplot.jpg",knn.plot,width=8,height=4)
which.min(knn.missrate)
###lowest missclassification with k=7
knn.out<-confusionMatrix(data=knn.pred[[7]],reference=normvalidate$diabetes,positive="Yes")
#77.68
#####NAIVE BAYES####
#73.21
##separate variables in x and y
naivetrain<-train[,-7]
naivelabels<-train$diabetes
naive
naive<-train(naivetrain,naivelabels,"nb",trControl=trainControl(method="cv",number=10))
naive.pred<-predict(naive,newdata = validate)
naive.out<-confusionMatrix(data=naive.pred,reference=validate$diabetes,positive="Yes")
###LOGIT###
#80.36
logit<-glm(diabetes~.,data=train,family=binomial(link=logit))
summary(logit)
logit.pred<-predict(logit,newdata = validate,type="response")
logit.pred.class<-ifelse(logit.pred>0.5,"Yes","No")
logit.out<-confusionMatrix(data=logit.pred.class,reference=validate$diabetes,positive="Yes")
#####COMPARISON####
confmodels<-list(dtree.prune.out,
knn.out,naive.out)
modelnames<-c("Decision Tree Prune","KNN",
"Naive Bayes")
comp<-comparisondf(confmodels,modelnames)
complot<-ggplot(data=comp,aes(x=Model,y=Accuracy))+geom_col(fill="green4")
ggsave("plots/accuracy.jpg",complot,width=8,height=4)
dplyr::select(comp,c(Model,Accuracy,Specificity,Sensitivity)) %>%
gather(Accuracy,Specificity,Sensitivity,key=measure,value=value) %>%
ggplot()+geom_line(aes(x=measure,y=value,color=Model,group=Model))
source('C:/Users/Administrador.000/Desktop/Sebastian/Repos/diabetes/script.R', echo=TRUE)
library(tidyverse)
library(cluster)
library(factoextra)
source("r/functions.R")
dataset<-read_csv("data/HTRU_2bis.csv")
names(dataset)<-c("X","meanip","sdip","kurtip",
"skewip","meandm","sddm",
"kurtdm","skedm")
library(tidyverse)
library(cluster)
library(factoextra)
source("r/functions.R")
setwd("C:/Users/Administrador.000/Desktop/Sebastian/Repos/pulsar")
source("r/functions.R")
dataset<-read_csv("data/HTRU_2bis.csv")
names(dataset)<-c("X","meanip","sdip","kurtip",
"skewip","meandm","sddm",
"kurtdm","skedm")
sample(dataset,1000)
sample(dataset$meanip,1000)
sample_n(data,1000)
sample_n(dataset,1000)
library(tidyverse)
library(cluster)
library(factoextra)
source("r/functions.R")
dataset<-read_csv("data/HTRU_2bis.csv")
names(dataset)<-c("X","meanip","sdip","kurtip",
"skewip","meandm","sddm",
"kurtdm","skedm")
tidyverse
dataset<-select(dataset,-X)
distancematrix<-dist(dataset,method="euclidean")
clust<-hclust(distancematrix,method="ward.D")
?hclust
plot(hc,hang=-1,labels=FALSE)
plot(clust,hang=-1,labels=FALSE)
prcomp(dataset)
pca<-prcomp(dataset)
pca$y
prcomp
?prcomp
names(pca)
pca<-prcomp(dataset,scale=TRUE)
pca$x
datapca<-bind_cols(dataset,pca$x)
as.data,frame(pca$x)
as.data.frame(pca$x)
datapca<-bind_cols(dataset,as.data.frame(pca$x))
datapca
ggplot()+geom_point(data=datapca,aes(x=PC1,y=PC2))
hc2<-cutree(clust,k=2)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(color=hc2)
hc2<-cutree(clust,k=3)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(color=hc2)
hc2<-cutree(clust,k=4)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(color=hc2)
hc2<-cutree(clust,k=5)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(color=hc2)
kmeans(dataset,nstart = 30,centers = 3)
a<-kmeans(dataset,nstart = 30,centers = 3)
kmeansvec<-function(data,k){
vec<-kmeans(data,nstart = 30,centers = k)$cluster
return(vec)
}
a<-map_dbl(c(1:10),~kmeasvec(dataset,.))
a<-map_dbl(c(1:10),~kmeansvec(dataset,.))
kmeansvec(dataset,2)
a<-map(c(1:10),~kmeansvec(dataset,.))
vec<-data.frame(a)
vec
vec<-as.data.frame(a)
names(a)<-paste("k=",x,sep="")
names(a)<-paste("k=",c(1:10),sep="")
vec<-as.data.frame(a)
datapca<-bind_cols(dataset,as.data.frame(pca$x),vec)
datapca %>%
gather(k.1:k.10,key=k,value=cluster)
datapca<-datapca %>%
gather(k.1:k.10,key=k,value=cluster)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(color=cluster)+
facet_wrap(.k)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(aes(color=cluster))+
facet_wrap(.k)
ggplot(data=datapca,aes(x=PC1,y=PC2))+geom_point(aes(color=cluster))+
facet_wrap(.~k)
ggplot(data=datapca,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(.~k)
ggplot(data=datapca,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=2)
datapca$cluster<-as.factor(datapca$cluster)
ggplot(data=datapca,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
fviz_screeplot(pca)
fviz_pca_var(pca,col.var="contrib")
ggplot(data=datapca,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
names(a)<-c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten")
datapca$k<-factor(datapca$k,levels = c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten")) )
datapca$k<-factor(datapca$k,levels = c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten"))
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
vec<-as.data.frame(a)
datapca<-bind_cols(dataset,as.data.frame(pca$x),vec)
datapca<-datapca %>%
gather(k.1:k.10,key=k,value=cluster)
datapca<-datapca %>%
gather(One:Ten,key=k,value=cluster)
datapca$cluster<-as.factor(datapca$cluster)
datapca$k<-factor(datapca$k,levels = c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten"))
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)+coord_cartesian(xlim=c(0,50))
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)+coord_cartesian(xlim=c(0,20))
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=sdip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=kurtip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
fviz_screeplot(pca)
fviz_pca_var(pca,col.var="contrib")
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=sddm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=kurtdm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=skewdm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=skedm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
histplots<-multiplehist(dataset)
multiplot(plotlist = histplots,cols=3)
ggplot(data=datapca,aes(x=kurtdm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=skedm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
fviz_pca_var(pca,col.var="contrib")
source('C:/Users/Administrador.000/Desktop/Sebastian/Repos/pulsar/r/functions.R', echo=TRUE)
kmeans.ss<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
return(map_dbl(data,~aux(data,.)))
}
kmeans.clust<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$cluster
return(ss)
}
return(map(data,~aux(data,.)))
}
kmeans.clust<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$cluster
return(ss)
}
return(map(k,~aux(data,.)))
}
kmeans.ss<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
return(map_dbl(k,~aux(data,.)))
}
kmeans.clust<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$cluster
return(ss)
}
return(as.data.frame(map(k,~aux(data,.))))
}
kmeansclusters<-kmeans.clust(dataset,10)
kmeansss<-kmeans.ss(dataset,10)
kss<-data.frame(k=c(1:10),ss=kmeansss)
ggplot(kss,aes(x=k,y=ss))+geom_line()
kmeans.ss<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
return(map_dbl(k,~aux(data,.)))
}
kmeansss<-kmeans.ss(dataset,10)
kmeans.ss<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
return(map(k,~aux(data,.)))
}
kmeansss<-kmeans.ss(dataset,10)
names(kmeansclusters)<-c("One","Two","Three","Four",
"Five","Six","Seven","Eight",
"Nine","Ten")
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
map_dbl(list(1:10),aux(dataset,.))
map_dbl(list(1:10),~aux(dataset,.))
map_dbl(c(1:10),~aux(dataset,.))
kmeansss<-kmeans.ss(dataset,c(1:10))
kss<-data.frame(k=c(1:10),ss=kmeansss)
kmeans.ss<-function(data,k){
aux<-function(data,k){
ss<-kmeans(data,nstart = 30,centers = k)$tot.withinss
return(ss)
}
return(map_dbl(k,~aux(data,.)))
}
kmeansss<-kmeans.ss(dataset,c(1:10))
kss<-data.frame(k=c(1:10),ss=kmeansss)
ggplot(kss,aes(x=k,y=ss))+geom_line()
kmeansclusters<-kmeans.clust(dataset,c(1:10))
names(kmeansclusters)<-c("One","Two","Three","Four",
"Five","Six","Seven","Eight",
"Nine","Ten")
datakmeans<-bind_cols(datapca,kmeansclusters)
datapca<-bind_cols(dataset,as.data.frame(pca$x))
datakmeans<-bind_cols(datapca,kmeansclusters)
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(One:Ten,key=k,value=cluster)
datapca$cluster<-factor(datapca$cluster,levels = c(1:10))
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(One:Ten,key=k,value=cluster) %>%
factor(.$cluster,levels = c(1:10)) %>%
factor(.$k,levels = c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten"))
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(One:Ten,key=k,value=cluster)
View(datakmeans)
datakmeans$cluster<-factor(datakmeans$cluster,levels = c(1:10))
datakmeans$k<-factor(datakmeans$k,levels = c("One","Two","Three","Four","Five","Six",
"Seven","Eight","Nine","Ten"))
ggplot(data=datakmeans,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
ggplot(data=datapca,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datakmeans,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
names(kmeansclusters)<-as.character(k)
k<-c(1:10)
names(kmeansclusters)<-as.character(k)
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(1:10,key=k,value=cluster)
datakmeans$cluster<-factor(datakmeans$cluster,levels = c(1:10))
datakmeans$k<-factor(datakmeans$k,levels=as.character(k))
ggplot(data=datakmeans,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(1:10,key=k,value=cluster)
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather("1":"10",key=k,value=cluster)
knames<-c("One","Two","Three","Four","Five","Six","Seven"
"Eight","Nine","Ten")
knames<-c("One","Two","Three","Four","Five","Six","Seven",
"Eight","Nine","Ten")
names<-kmeansclusters(knames)
names(kmeansclusters)<-knames
datakmeans<-datapca %>%
bind_cols(kmeansclusters) %>%
gather(One:Ten,key=k,value=cluster)
datakmeans$cluster<-factor(datakmeans$cluster,levels=c(1:10))
datakmeans$k<-factor(datakmeans$k,levels=knames)
distance<-dist(dataset,method="euclidean")
ggplot(kss,aes(x=k,y=ss))+geom_line()
ggplot(kss,aes(x=k,y=ss))+geom_line()+geom_point()
clustvectors<-function(dmatrix,k,method){
clust<-hclust(dmatrix,method=method)
aux<-function(hclust,k){
return(cutree(hclust,k))
}
return(as.data.frame(map(k,~aux(hclust,.))))
}
vectors<-clustvectors(distance,k,"single")
clustvectors<-function(dmatrix,k,method){
clust<-hclust(dmatrix,method=method)
aux<-function(hclust,k){
return(cutree(hclust,k))
}
return(as.data.frame(map(k,~aux(clust,.))))
}
vectors<-clustvectors(distance,k,"single")
names(vectors)<-knames
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather(One:Ten,key=k,value=cluster)
datahclust$cluster<-factor(datahclust$cluster,levels=c(1:10))
datahclust$k<-factor(datahclust$k,levels=knames)
ggplot(data=datahclust,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
vectors<-clustvectors(distance,k,"average")
knames<-c("One","Two","Three","Four","Five","Six","Seven",
"Eight","Nine","Ten")
names(vectors)<-knames
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather(One:Ten,key=k,value=cluster)
datahclust$cluster<-factor(datahclust$cluster,levels=c(1:10))
datahclust$k<-factor(datahclust$k,levels=knames)
ggplot(data=datahclust,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
ggplot(data=datahclust,aes(x=meandm,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
ggplot(data=datahclust,aes(x=meanip,color=cluster))+geom_density()+
facet_wrap(~k,ncol=3)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather("One":"Ten",key=k,value=cluster)
vectors<-clustvectors(distance,k,"ward.D")
knames<-c("One","Two","Three","Four","Five","Six","Seven",
"Eight","Nine","Ten")
names(vectors)<-knames
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather(One:Ten,key=k,value=cluster)
datahclust$cluster<-factor(datahclust$cluster,levels=c(1:10))
datahclust$k<-factor(datahclust$k,levels=knames)
ggplot(data=datahclust,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean)
datahclust %>%
group_by(k,cluster) %>%
summarize_all(max)
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
View()
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
summarize(n())
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean,n) %>%
View()
datahclust %>%
group_by(k,cluster) %>%
summarize(n())
datahclust %>%
group_by(k,cluster) %>%
summarize(count=n())
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
summarize(count=n()) %>%
View()
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by(k,cluster) %>%
summarize(count=n()),by=c("k","cluster"))
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by(k,cluster) %>%
summarize(count=n()),by=c("k","cluster"))%>%
select(c(1:2,19,3:18) %>%
View()
datahclust %>%
group_by(k,cluster) %>%
summarize(count=n())
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by(k,cluster) %>%
summarize(count=n()),by=c("k","cluster"))
datahclust %>%
group_by(k,cluster) %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by(k,cluster) %>%
summarize(count=n()),by=c("k","cluster")) %>%
select(c(1:2,19,3:18)) %>%
View()
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather_("One:Ten",key=k,value=cluster)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather_("One":"Ten",key=k,value=cluster)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather(-meanip:PC8:Ten,key=k,value=cluster)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather(-meanip:PC8,key=k,value=cluster)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather_(datahclust,key=k,value=cluster,gather_cols = knames)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather_(datahclust,key="k",value="cluster",gather_cols = knames)
datahclust<-datapca %>%
bind_cols(vectors) %>%
gather_(key="k",value="cluster",gather_cols = knames)
datahclust$cluster<-factor(datahclust$cluster,levels=c(1:10))
datahclust$k<-factor(datahclust$k,levels=knames)
datahclust %>%
group_by_("k","cluster") %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by("k","cluster") %>%
summarize(count=n()),by=c("k","cluster"))
datahclust %>%
group_by_("k","cluster") %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by_("k","cluster") %>%
summarize(count=n()),by=c("k","cluster"))
ggplot(data=datahclust,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)+ggtitle("Clustering")
datahclust$k<-factor(datahclust$k,levels=knames,labels=paste("K=",k,sep=""))
ggplot(data=datahclust,aes(x=PC1,y=PC2,color=cluster))+geom_point()+
facet_wrap(~k,ncol=3)+ggtitle("Clustering")
datahclust %>%
group_by_("k","cluster") %>%
summarize_all(mean) %>%
left_join(datahclust %>%
group_by_("k","cluster") %>%
summarize(count=n()),by=c("k","cluster"))
